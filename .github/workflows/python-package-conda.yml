name: Automatic testing

on: 
  pull_request:
    branches:
      - master

jobs:
  build-linux:
    runs-on: ubuntu-latest
    strategy:
      max-parallel: 5

    steps:
    - uses: actions/checkout@v2
    - name: Add conda to system path
      run: |
        # $CONDA is an environment variable pointing to the root of the miniconda directory
        echo $CONDA/bin >> $GITHUB_PATH
    - name: Install dependencies
      run: |
        conda env update --file environment.yml --name base
    - name: get GDB
      run: | 
        sudo apt-get update
        sudo apt-get install gdb
    - name: Make test programs
      run: |
        make all
    - name: Test ex_prog1
      run: |
        ./trace.py ex_prog1
    - name: Test ex_prog2
      run: |
        ./trace.py ex_prog2
    - name: Test example
      run: |
        ./trace.py example
    - name: Test argument_test
      run: |
        ./trace.py argument_test
    - name: Test recursion
      run: |
        ./trace.py recursion
    - name: Test map
      run: |
        ./trace.py map
